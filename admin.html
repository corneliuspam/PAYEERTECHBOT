<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Payeer Tech - Admin Panel</title>
<style>
  body {margin:0;font-family:Arial,sans-serif;background:#fff;color:#333;}
  header {background:#4caf50;color:#fff;padding:15px;text-align:center;font-size:22px;font-weight:bold;}
  .container{padding:15px;}
  .card{background:#f0f0f0;border-radius:10px;padding:15px;margin-bottom:20px;}
  h3{margin-top:0;color:#4caf50;}
  input,textarea,select{width:100%;padding:10px;margin-top:8px;border-radius:6px;border:1px solid #ccc;}
  textarea{resize:none;}
  button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:8px;background:#4caf50;color:#fff;font-size:16px;}
  table{width:100%;border-collapse:collapse;margin-top:10px;}
  table th, table td{border-bottom:1px solid #ddd;padding:8px;text-align:left;}
  .approve{background:#2196f3;}
  .reject{background:#f44336;}
</style>
</head>
<body>

<header>PAYEER TECH - ADMIN PANEL</header>

<div class="container">

  <!-- API BASE -->
  <script>
    https://payeer-backend.onrender.com
  </script>

  <!-- Admin Login -->
  <div class="card" id="loginCard">
    <h3>Admin Login</h3>
    <input id="adminEmail" type="email" placeholder="Admin Email" value="corneliuspam8736@gmail.com"/>
    <input id="adminPassword" type="password" placeholder="Admin Password" value="2001@pam"/>
    <button onclick="adminLogin()">Login</button>
    <p id="loginStatus"></p>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display:none;">
    <!-- Post Announcement -->
    <div class="card">
      <h3>Post Announcement</h3>
      <textarea id="announcement" rows="3" placeholder="Admin message"></textarea>
      <button onclick="postAnnouncement()">Send Announcement</button>
    </div>

    <!-- Create Task -->
    <div class="card">
      <h3>Create Task</h3>
      <input id="taskTitle" placeholder="Task Title"/>
      <textarea id="taskDesc" placeholder="Task Description"></textarea>
      <button onclick="createTask()">Post Task</button>
    </div>

    <!-- Pending Tasks -->
    <div class="card">
      <h3>Pending Task Approvals</h3>
      <table id="taskTable">
        <tr><th>User</th><th>Task</th><th>Action</th></tr>
      </table>
    </div>

    <!-- Withdrawal Requests -->
    <div class="card">
      <h3>Withdrawal Requests</h3>
      <table id="withdrawTable">
        <tr><th>User</th><th>Amount</th><th>Bank</th><th>Action</th></tr>
      </table>
    </div>

    <button onclick="logout()">Logout</button>
  </div>

</div>

<script>
// Admin login
function adminLogin(){
  const email=document.getElementById("adminEmail").value;
  const pass=document.getElementById("adminPassword").value;
  if(email==="corneliuspam8736@gmail.com" && pass==="2001@pam"){
    document.getElementById("loginCard").style.display="none";
    document.getElementById("dashboard").style.display="block";
    loadTasks();
    loadWithdrawals();
  }else{
    document.getElementById("loginStatus").innerText="Invalid login";
  }
}

// Post announcement
function postAnnouncement(){
  const message=document.getElementById("announcement").value;
  fetch(API_BASE+"/api/admin/announcement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message})})
  .then(()=>alert("Announcement sent"));
}

// Create task
function createTask(){
  const title=document.getElementById("taskTitle").value;
  const desc=document.getElementById("taskDesc").value;
  fetch(API_BASE+"/api/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title,description:desc,reward:1000})})
  .then(()=>{alert("Task posted"); loadTasks();});
}

// Load pending tasks
function loadTasks(){
  fetch(API_BASE+"/api/tasks")
  .then(res=>res.json())
  .then(tasks=>{
    const table=document.getElementById("taskTable");
    table.innerHTML='<tr><th>User</th><th>Task</th><th>Action</th></tr>';
    tasks.forEach(t=>{
      table.innerHTML+=`<tr>
        <td>${t.userId||"-"}</td>
        <td>${t.title}</td>
        <td><button onclick="approveTask('${t._id}','${t.userId||""}')">Approve</button></td>
      </tr>`;
    });
  });
}

// Approve task
function approveTask(taskId,userId){
  fetch(API_BASE+"/api/admin/approve-task",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId,userId})})
  .then(()=>{alert("Task approved"); loadTasks();});
}

// Load withdrawal requests
function loadWithdrawals(){
  fetch(API_BASE+"/api/admin/withdrawals")
  .then(res=>res.json())
  .then(list=>{
    const table=document.getElementById("withdrawTable");
    table.innerHTML='<tr><th>User</th><th>Amount</th><th>Bank</th><th>Action</th></tr>';
    list.forEach(w=>{
      table.innerHTML+=`<tr>
        <td>${w.userId}</td>
        <td>â‚¦${w.amount}</td>
        <td>${w.bank}</td>
        <td><button onclick="approveWithdrawal('${w._id}')">Approve</button></td>
      </tr>`;
    });
  });
}

// Approve withdrawal
function approveWithdrawal(id){
  fetch(API_BASE+"/api/admin/approve-withdrawal",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id})})
  .then(()=>{alert("Withdrawal approved"); loadWithdrawals();});
}

function logout(){
  location.reload();
}
</script>

</body>
</html>
